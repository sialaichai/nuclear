<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Question Editor</title>
    <style>
        :root {
            --primary: #4f46e5;
            --danger: #ef4444;
            --success: #22c55e;
            --bg: #f3f4f6;
            --card-bg: #ffffff;
            --border: #e5e7eb;
            --text-main: #1f2937;
            --text-sub: #6b7280;
        }

        body { margin: 0; display: flex; height: 100vh; font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text-main); }
        
        /* Sidebar */
        #sidebar { width: 260px; background: #111827; color: white; display: flex; flex-direction: column; border-right: 1px solid #374151; }
        #sidebar h2 { padding: 1.5rem; margin: 0; font-size: 1.25rem; border-bottom: 1px solid #374151; }
        #file-list { flex: 1; overflow-y: auto; padding: 1rem; }
        
        .file-btn {
            width: 100%; text-align: left; padding: 12px; margin-bottom: 4px;
            background: transparent; border: none; color: #9ca3af; cursor: pointer;
            border-radius: 6px; font-size: 0.95rem; transition: all 0.2s;
        }
        .file-btn:hover { background: #374151; color: white; }
        .file-btn.active { background: var(--primary); color: white; font-weight: 600; }

        /* Main Content */
        #main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        
        /* Toolbar */
        .toolbar {
            background: var(--card-bg); padding: 1rem 2rem; border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center; box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .toolbar h1 { font-size: 1.25rem; margin: 0; }
        .toolbar .actions { display: flex; gap: 10px; }

        /* Scrollable Form Area */
        #form-container { flex: 1; overflow-y: auto; padding: 2rem; scroll-behavior: smooth; }
        .empty-state { text-align: center; color: var(--text-sub); margin-top: 3rem; }

        /* Question Cards */
        .q-card {
            background: var(--card-bg); border: 1px solid var(--border); border-radius: 8px;
            padding: 1.5rem; margin-bottom: 1.5rem; position: relative;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05); transition: box-shadow 0.2s;
        }
        .q-card:hover { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        
        .q-header { display: flex; justify-content: space-between; margin-bottom: 1rem; border-bottom: 1px solid var(--border); padding-bottom: 0.5rem; }
        .q-id { font-weight: bold; color: var(--primary); }
        
        /* Form Grids */
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem; }
        .full-width { grid-column: span 2; }
        
        label { display: block; font-size: 0.85rem; font-weight: 600; color: var(--text-sub); margin-bottom: 0.4rem; }
        input, textarea, select {
            width: 100%; padding: 0.6rem; border: 1px solid var(--border); border-radius: 4px;
            font-size: 0.95rem; font-family: inherit; box-sizing: border-box; transition: border 0.2s;
        }
        input:focus, textarea:focus, select:focus { border-color: var(--primary); outline: none; ring: 2px var(--primary); }
        textarea { resize: vertical; min-height: 80px; }

        /* Options Section */
        .options-group { background: #f9fafb; padding: 1rem; border-radius: 6px; border: 1px solid var(--border); margin-bottom: 1rem; }
        .option-row { display: flex; align-items: center; margin-bottom: 0.5rem; gap: 10px; }
        .option-row input[type="radio"] { width: auto; cursor: pointer; }
        
        /* Buttons */
        .btn { padding: 0.6rem 1.2rem; border-radius: 6px; border: none; font-weight: 600; cursor: pointer; font-size: 0.9rem; transition: opacity 0.2s; }
        .btn:hover { opacity: 0.9; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-danger { background: white; color: var(--danger); border: 1px solid var(--border); padding: 4px 8px; font-size: 0.8rem; }
        .btn-danger:hover { background: #fee2e2; border-color: var(--danger); }
        .btn-add { background: var(--text-main); color: white; display: block; width: 100%; margin-top: 2rem; padding: 1rem; }
    </style>
</head>
<body>

<div id="sidebar">
    <h2>üìÇ Question Files</h2>
    <div id="file-list"></div>
    <div style="padding: 1rem; font-size: 0.8rem; color: #6b7280;">
        Requires server (Live Server/GitHub Pages)
    </div>
</div>

<div id="main">
    <div class="toolbar">
        <h1 id="page-title">Select a file</h1>
        <div class="actions">
            <button class="btn btn-primary" onclick="downloadData()">‚¨áÔ∏è Download Updated File</button>
        </div>
    </div>
    <div id="form-container">
        <div class="empty-state">No file loaded. Click a file on the left to start.</div>
    </div>
</div>

<script>
    // ==========================================
    // ‚öôÔ∏è CONFIG: LIST YOUR FILES HERE
    // ==========================================
    const FILES = [
        "level1.js",
        "level2.js",
        "level3.js",
        "level4.js",
        "level5.js"
    ];
    
    const BASE_PATH = "questions/";

    // ==========================================
    // üöÄ STATE MANAGEMENT
    // ==========================================
    let currentData = null;      // Holds the JS object (e.g., Level1Questions)
    let currentVarName = "";     // Holds "Level1Questions" string
    let currentFileName = "";    // Holds "level1.js"

    // Initialize Sidebar
    const fileListEl = document.getElementById('file-list');
    FILES.forEach(f => {
        const btn = document.createElement('button');
        btn.className = 'file-btn';
        btn.textContent = f;
        btn.onclick = () => loadFile(f, btn);
        fileListEl.appendChild(btn);
    });

    // 1. Load & Parse File
    async function loadFile(filename, btn) {
        // UI Reset
        document.querySelectorAll('.file-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('page-title').textContent = filename;
        const container = document.getElementById('form-container');
        container.innerHTML = '<div class="empty-state">Loading...</div>';

        try {
            const res = await fetch(BASE_PATH + filename);
            if (!res.ok) throw new Error("File not found");
            const text = await res.text();

            // PARSING LOGIC: Extract variable name and object
            // Regex matches: const VariableName = { ... };
            const match = text.match(/const\s+(\w+)\s*=\s*(\{[\s\S]*\});?/);
            
            if (!match) throw new Error("Could not parse file structure. Ensure it starts with 'const Name = {'.");

            currentFileName = filename;
            currentVarName = match[1]; // e.g. "Level1Questions"
            const jsonStr = match[2];  // The object part

            // We use Function constructor to safely parse the JS object string 
            // (handles unquoted keys which JSON.parse hates)
            const parseFn = new Function(`return ${jsonStr};`);
            currentData = parseFn();

            renderForm();
        } catch (e) {
            console.error(e);
            container.innerHTML = `<div class="empty-state" style="color:red">Error: ${e.message}</div>`;
        }
    }

    // 2. Render Form
    function renderForm() {
        const container = document.getElementById('form-container');
        container.innerHTML = '';

        if (!currentData.questions) {
            container.innerHTML = '<div class="empty-state">No questions array found in this file.</div>';
            return;
        }

        // Loop through questions
        currentData.questions.forEach((q, index) => {
            const card = document.createElement('div');
            card.className = 'q-card';
            card.innerHTML = buildCardHTML(q, index);
            container.appendChild(card);
        });

        // Add "New Question" Button
        const addBtn = document.createElement('button');
        addBtn.className = 'btn btn-add';
        addBtn.textContent = "‚ûï Add New Question";
        addBtn.onclick = addNewQuestion;
        container.appendChild(addBtn);
    }

    // 3. HTML Builder for a single Question Card
    function buildCardHTML(q, index) {
        return `
            <div class="q-header">
                <span class="q-id">#${index + 1} (ID: ${q.id})</span>
                <button class="btn btn-danger" onclick="deleteQuestion(${index})">üóë Remove</button>
            </div>
            
            <div class="form-grid">
                <div class="full-width">
                    <label>Question Text</label>
                    <textarea oninput="updateField(${index}, 'question', this.value)">${escapeHtml(q.question)}</textarea>
                </div>
                
                <div>
                    <label>Topic</label>
                    <input type="text" value="${escapeHtml(q.topic || '')}" oninput="updateField(${index}, 'topic', this.value)">
                </div>
                <div>
                    <label>Points</label>
                    <input type="number" value="${q.points || 100}" oninput="updateField(${index}, 'points', parseInt(this.value))">
                </div>
            </div>

            <div class="options-group">
                <label>Options & Correct Answer</label>
                ${q.options.map((opt, i) => `
                    <div class="option-row">
                        <input type="radio" name="correct_${index}" ${q.correctAnswer === i ? 'checked' : ''} onchange="updateField(${index}, 'correctAnswer', ${i})" title="Mark as correct answer">
                        <input type="text" value="${escapeHtml(opt)}" oninput="updateOption(${index}, ${i}, this.value)" placeholder="Option ${i+1}">
                    </div>
                `).join('')}
            </div>

            <div class="form-grid">
                <div class="full-width">
                    <label>Explanation</label>
                    <textarea style="min-height:60px" oninput="updateField(${index}, 'explanation', this.value)">${escapeHtml(q.explanation || '')}</textarea>
                </div>
                <div class="full-width">
                    <label>Hint</label>
                    <input type="text" value="${escapeHtml(q.hint || '')}" oninput="updateField(${index}, 'hint', this.value)">
                </div>
            </div>
        `;
    }

    // 4. Data Update Handlers
    window.updateField = (index, field, value) => {
        currentData.questions[index][field] = value;
    };

    window.updateOption = (qIndex, optIndex, value) => {
        currentData.questions[qIndex].options[optIndex] = value;
    };

    window.deleteQuestion = (index) => {
        if(confirm("Delete this question?")) {
            currentData.questions.splice(index, 1);
            renderForm(); // Re-render to update indices
        }
    };

    window.addNewQuestion = () => {
        const newId = currentData.questions.length > 0 ? Math.max(...currentData.questions.map(q => q.id)) + 1 : 1;
        currentData.questions.push({
            id: newId,
            question: "New Question",
            options: ["A", "B", "C", "D"],
            correctAnswer: 0,
            explanation: "",
            hint: "",
            points: 100,
            topic: "General"
        });
        renderForm();
        // Scroll to bottom
        setTimeout(() => {
            const container = document.getElementById('form-container');
            container.scrollTop = container.scrollHeight;
        }, 100);
    };

    // 5. Download Logic
    window.downloadData = () => {
        if (!currentData) return;

        // Convert back to JS File string
        // We use JSON.stringify but strip quotes from keys if possible to match style, 
        // OR just keep standard JSON format which is valid JS.
        // Let's stick to valid formatted JSON assigned to the variable.
        
        const jsonString = JSON.stringify(currentData, null, 4);
        const fileContent = `const ${currentVarName} = ${jsonString};\n`;

        const blob = new Blob([fileContent], { type: 'text/javascript' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = currentFileName;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    };

    // Helper to prevent HTML breaking inside inputs
    function escapeHtml(text) {
        if (!text) return "";
        return text
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
    }

</script>

</body>
</html>
